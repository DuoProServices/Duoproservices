name: Deploy to Supabase

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ”„ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: ğŸ”§ Install Supabase CLI
        run: npm install -g supabase

      - name: ğŸš€ Deploy Edge Function
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
          PROJECT_ID: lqpmyvizjfwzddxspacv
        run: |
          echo "ğŸ”— Linking project..."
          supabase link --project-ref $PROJECT_ID
          
          echo "ğŸ“¤ Deploying function 'server'..."
          supabase functions deploy server --project-ref $PROJECT_ID --no-verify-jwt
          
          echo "âœ… Deploy completed!"

      - name: ğŸ‰ Success
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  âœ… DEPLOY COMPLETED SUCCESSFULLY!                             â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“ URL: https://lqpmyvizjfwzddxspacv.supabase.co/functions/v1/make-server-c2a25be0"
          echo ""
          echo "ğŸ§ª Test: curl https://lqpmyvizjfwzddxspacv.supabase.co/functions/v1/make-server-c2a25be0/health"
