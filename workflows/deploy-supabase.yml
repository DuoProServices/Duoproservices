name: Deploy Supabase Edge Function

on:
  # Executa quando vocÃª fizer push na branch main
  push:
    branches:
      - main
  
  # Ou quando vocÃª executar manualmente
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ”„ Checkout cÃ³digo
        uses: actions/checkout@v3

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: ğŸ”§ Instalar Supabase CLI
        run: npm install -g supabase

      - name: ğŸš€ Deploy Edge Function
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
          PROJECT_ID: lqpmyvizjfwzddxspacv
        run: |
          echo "ğŸ”— Linkando projeto..."
          supabase link --project-ref $PROJECT_ID
          
          echo "ğŸ“¤ Fazendo deploy da funÃ§Ã£o 'server'..."
          supabase functions deploy server --project-ref $PROJECT_ID --no-verify-jwt
          
          echo "âœ… Deploy concluÃ­do!"

      - name: ğŸ‰ Sucesso!
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘  âœ… DEPLOY CONCLUÃDO COM SUCESSO!                              â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“ URL: https://lqpmyvizjfwzddxspacv.supabase.co/functions/v1/make-server-c2a25be0"
          echo ""
          echo "ğŸ§ª Teste: curl https://lqpmyvizjfwzddxspacv.supabase.co/functions/v1/make-server-c2a25be0/health"
