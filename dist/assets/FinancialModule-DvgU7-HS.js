import{r as l,s as y,A as u,t as g,j as e,L as P,D as R,T as M,d as N,F as v,a as T,C as U,e as B,X as O,f as $}from"./index-DZ1v8t67.js";import{I as Y}from"./localApiMock-dgIox5FE.js";const d=o=>new Intl.NumberFormat("en-CA",{style:"currency",currency:"CAD"}).format(o);function z(){const[o,p]=l.useState([]),[w,h]=l.useState(!0),[I,f]=l.useState(!1),[r,A]=l.useState({totalRevenue:0,pendingAmount:0,paidAmount:0,totalInvoices:0,pendingInvoices:0,paidInvoices:0}),[x,k]=l.useState("all"),[m,D]=l.useState("all");l.useEffect(()=>{S()},[]),l.useEffect(()=>{C()},[o]);const S=async()=>{var t,s;h(!0);try{const{data:a,error:i}=await y.auth.getSession();if(i||!a.session)throw new Error("Not authenticated");try{console.log("ðŸ”„ [FinancialModule] Trying API:",u.bookkeepingInvoices);const c=await fetch(u.bookkeepingInvoices,{headers:{Authorization:`Bearer ${a.session.access_token}`}});if(!c.ok)throw new Error("Backend API failed");const n=await c.json();console.log("âœ… [FinancialModule] Loaded from API:",((t=n.invoices)==null?void 0:t.length)||0),p(n.invoices||[]),f(!1)}catch{console.log("ðŸ“¦ [FinancialModule] Using local storage fallback..."),f(!0);const n=await Y.getInvoices();console.log("âœ… [FinancialModule] Loaded from local:",((s=n.invoices)==null?void 0:s.length)||0),p(n.invoices||[])}}catch(a){console.error("Error loading invoices:",a),g.error("Failed to load invoices")}finally{h(!1)}},C=()=>{const t=j(o),s={totalRevenue:0,pendingAmount:0,paidAmount:0,totalInvoices:t.length,pendingInvoices:0,paidInvoices:0};t.forEach(a=>{a.status==="paid"?(s.paidAmount+=a.amount,s.paidInvoices+=1):a.status==="pending"&&(s.pendingAmount+=a.amount,s.pendingInvoices+=1)}),s.totalRevenue=s.paidAmount+s.pendingAmount,A(s)},j=t=>{if(m==="all")return t;const s=new Date,a=new Date;switch(m){case"month":a.setMonth(s.getMonth()-1);break;case"quarter":a.setMonth(s.getMonth()-3);break;case"year":a.setFullYear(s.getFullYear()-1);break}return t.filter(i=>new Date(i.createdAt)>=a)},b=o.filter(t=>x==="all"||t.status===x).filter(t=>j([t]).length>0).sort((t,s)=>new Date(s.createdAt).getTime()-new Date(t.createdAt).getTime()),F=async t=>{try{const{data:s}=await y.auth.getSession();if(!s.session)return;const a=await fetch(u.invoicePdf(t),{headers:{Authorization:`Bearer ${s.session.access_token}`}});if(!a.ok)throw new Error("Failed to download invoice");const i=await a.blob(),c=window.URL.createObjectURL(i),n=document.createElement("a");n.href=c,n.download=`invoice-${t}.pdf`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(c),document.body.removeChild(n),g.success("Invoice downloaded successfully")}catch(s){console.error("Download error:",s),g.error("Failed to download invoice")}},E=t=>{switch(t){case"paid":return e.jsx($,{className:"w-4 h-4 text-green-600"});case"pending":return e.jsx(N,{className:"w-4 h-4 text-orange-600"});case"cancelled":return e.jsx(O,{className:"w-4 h-4 text-red-600"});default:return null}},L=t=>{switch(t){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-orange-100 text-orange-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return w?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading financial data..."})]})}):e.jsxs("div",{className:"space-y-6",children:[I&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Using local storage (API endpoint not responding)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(R,{className:"w-5 h-5 text-blue-600"})})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:d(r.totalRevenue)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[r.totalInvoices," total invoices"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Paid"}),e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(M,{className:"w-5 h-5 text-green-600"})})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:d(r.paidAmount)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[r.paidInvoices," paid invoices"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-orange-600"})})]}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:d(r.pendingAmount)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[r.pendingInvoices," pending invoices"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Invoice"}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:e.jsx(v,{className:"w-5 h-5 text-purple-600"})})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:d(r.totalInvoices>0?r.totalRevenue/r.totalInvoices:0)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Across all invoices"})]})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:x,onChange:t=>k(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"paid",children:"Paid Only"}),e.jsx("option",{value:"pending",children:"Pending Only"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:m,onChange:t=>D(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"month",children:"Last Month"}),e.jsx("option",{value:"quarter",children:"Last Quarter"}),e.jsx("option",{value:"year",children:"Last Year"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center",children:[e.jsx(v,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No invoices found"})]})}):b.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm font-mono font-medium text-gray-900",children:["#",t.invoiceNumber]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.userName}),e.jsx("div",{className:"text-sm text-gray-500",children:t.userEmail})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:d(t.amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${L(t.status)}`,children:[E(t.status),t.status.charAt(0).toUpperCase()+t.status.slice(1)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(t.createdAt).toLocaleDateString("en-CA",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("button",{onClick:()=>F(t.invoiceNumber),className:"text-blue-600 hover:text-blue-900 inline-flex items-center gap-1",children:[e.jsx(B,{className:"w-4 h-4"}),"Download"]})})]},t.invoiceNumber))})]})})})]})}export{z as default};
